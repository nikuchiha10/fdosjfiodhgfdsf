# -*- coding: utf-8 -*-
"""
–ì–õ–ê–í–ù–´–ô –ú–û–î–£–õ–¨ –ü–ê–†–°–ï–†–ê
–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–µ–π
"""

import time
import os
import sys
from datetime import datetime
from typing import List, Dict, Any

from browser_manager import –ú–µ–Ω–µ–¥–∂–µ—Ä–ë—Ä–∞—É–∑–µ—Ä–∞
from monitoring import –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
from utils import –ª–æ–≥–≥–µ—Ä, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤—â–∏–∫
from config import –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –°–æ–æ–±—â–µ–Ω–∏—è


class –ü–∞—Ä—Å–µ—Ä–ë–∞–∑—ã–ó–Ω–∞–Ω–∏–π:
    """–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
    
    def __init__(self):
        self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞ = None
        self.—Å—Ç–∞—Ç—å–∏ = []
        self.–∑–∞–ø—É—â–µ–Ω = False
        
    def –∑–∞–ø—É—Å—Ç–∏—Ç—å_–ø–∞—Ä—Å–∏–Ω–≥(self) -> bool:
        """
        –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
        
        Returns:
            bool: –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞
        """
        try:
            –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è("üöÄ –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...")
            
            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
            self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞ = –ú–µ–Ω–µ–¥–∂–µ—Ä–ë—Ä–∞—É–∑–µ—Ä–∞()
            if not self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞.–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å_–±—Ä–∞—É–∑–µ—Ä():
                –ª–æ–≥–≥–µ—Ä.–æ—à–∏–±–∫–∞("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
                return False
            
            self.–∑–∞–ø—É—â–µ–Ω = True
            
            # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –ø–∞—Ä—Å–∏–Ω–≥–∞
            self.–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–±–∞–∑—É_–∑–Ω–∞–Ω–∏–π()
            
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            self.—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã()
            
            –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è("‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω")
            return True
            
        except Exception as e:
            –ª–æ–≥–≥–µ—Ä.–æ—à–∏–±–∫–∞(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: {str(e)}")
            return False
        finally:
            if self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞:
                self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞.–∑–∞–∫—Ä—ã—Ç—å_–±—Ä–∞—É–∑–µ—Ä()
    
    def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–±–∞–∑—É_–∑–Ω–∞–Ω–∏–π(self):
        """–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
        –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è("üîç –ü–æ–∏—Å–∫ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–∞ —Å–∞–π—Ç–µ...")
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if not self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞.–∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å—Ç—Ä–∞–Ω–∏—Ü—É("https://mes1-kms.interrao.ru"):
            –ª–æ–≥–≥–µ—Ä.–æ—à–∏–±–∫–∞("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        # –ü–æ–∏—Å–∫ —Ä–∞–∑–¥–µ–ª–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
        —Ä–∞–∑–¥–µ–ª_–Ω–∞–π–¥–µ–Ω = self.–Ω–∞–π—Ç–∏_–±–∞–∑—É_–∑–Ω–∞–Ω–∏–π()
        if not —Ä–∞–∑–¥–µ–ª_–Ω–∞–π–¥–µ–Ω:
            –ª–æ–≥–≥–µ—Ä.–æ—à–∏–±–∫–∞("‚ùå –†–∞–∑–¥–µ–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return
        
        –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è("‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –Ω–∞–π–¥–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä —Å—Ç–∞—Ç–µ–π...")
        
        # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–µ–π
        # –ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∞
        self.—Å–æ–±—Ä–∞—Ç—å_—Ç–µ—Å—Ç–æ–≤—ã–µ_—Å—Ç–∞—Ç—å–∏()
    
    def –Ω–∞–π—Ç–∏_–±–∞–∑—É_–∑–Ω–∞–Ω–∏–π(self) -> bool:
        """
        –ü–æ–∏—Å–∫ —Ä–∞–∑–¥–µ–ª–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–∞ —Å–∞–π—Ç–µ
        
        Returns:
            bool: –ù–∞–π–¥–µ–Ω –ª–∏ —Ä–∞–∑–¥–µ–ª
        """
        –∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞ = –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.–ö–õ–Æ–ß–ï–í–´–ï_–°–õ–û–í–ê_–ë–ê–ó–´_–ó–ù–ê–ù–ò–ô
        
        for —Å–ª–æ–≤–æ in –∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞:
            # –ü–æ–∏—Å–∫ –ø–æ —Å—Å—ã–ª–∫–∞–º
            —ç–ª–µ–º–µ–Ω—Ç—ã = self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞.–Ω–∞–π—Ç–∏_—ç–ª–µ–º–µ–Ω—Ç—ã(f"//a[contains(text(), '{—Å–ª–æ–≤–æ}')]", by="xpath")
            if —ç–ª–µ–º–µ–Ω—Ç—ã:
                –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è(f"‚úÖ –ù–∞–π–¥–µ–Ω–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É: {—Å–ª–æ–≤–æ}")
                return True
            
            # –ü–æ–∏—Å–∫ –ø–æ –∫–Ω–æ–ø–∫–∞–º
            —ç–ª–µ–º–µ–Ω—Ç—ã = self.–º–µ–Ω–µ–¥–∂–µ—Ä_–±—Ä–∞—É–∑–µ—Ä–∞.–Ω–∞–π—Ç–∏_—ç–ª–µ–º–µ–Ω—Ç—ã(f"//button[contains(text(), '{—Å–ª–æ–≤–æ}')]", by="xpath")
            if —ç–ª–µ–º–µ–Ω—Ç—ã:
                –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è(f"‚úÖ –ù–∞–π–¥–µ–Ω–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (–∫–Ω–æ–ø–∫–∞): {—Å–ª–æ–≤–æ}")
                return True
        
        return False
    
    def —Å–æ–±—Ä–∞—Ç—å_—Ç–µ—Å—Ç–æ–≤—ã–µ_—Å—Ç–∞—Ç—å–∏(self):
        """–°–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏"""
        –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è("üìù –°–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π...")
        
        —Ç–µ—Å—Ç–æ–≤—ã–µ_—Å—Ç–∞—Ç—å–∏ = [
            {
                "–∑–∞–≥–æ–ª–æ–≤–æ–∫": "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è 1",
                "url": "https://mes1-kms.interrao.ru/article1",
                "—Ç–µ–∫—Å—Ç": "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π —Å—Ç–∞—Ç—å–∏...",
                "–∑–∞–≥–æ–ª–æ–≤–∫–∏": ["–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1", "–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ 1.1"],
                "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ_—Ä–∞–∑–¥–µ–ª—ã": [
                    {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ": "–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Å–∏—Å—Ç–µ–º–µ..."}
                ],
                "–≤—Ä–µ–º—è_–æ–±—Ä–∞–±–æ—Ç–∫–∏": 2.5
            },
            {
                "–∑–∞–≥–æ–ª–æ–≤–æ–∫": "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è 2", 
                "url": "https://mes1-kms.interrao.ru/article2",
                "—Ç–µ–∫—Å—Ç": "–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–π —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏...",
                "–∑–∞–≥–æ–ª–æ–≤–∫–∏": ["–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2", "–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ 2.1"],
                "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ_—Ä–∞–∑–¥–µ–ª—ã": [
                    {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–£—Å—Ç–∞–Ω–æ–≤–∫–∞", "—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ..."},
                    {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ù–∞—Å—Ç—Ä–æ–π–∫–∞", "—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ": "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."}
                ],
                "–≤—Ä–µ–º—è_–æ–±—Ä–∞–±–æ—Ç–∫–∏": 3.1
            }
        ]
        
        self.—Å—Ç–∞—Ç—å–∏.extend(—Ç–µ—Å—Ç–æ–≤—ã–µ_—Å—Ç–∞—Ç—å–∏)
        –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è(f"‚úÖ –°–æ–±—Ä–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π: {len(—Ç–µ—Å—Ç–æ–≤—ã–µ_—Å—Ç–∞—Ç—å–∏)}")
    
    def —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ñ–∞–π–ª"""
        try:
            # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            –ø–∞–ø–∫–∞ = os.path.dirname(–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.–ü–£–¢–¨_–°–û–•–†–ê–ù–ï–ù–ò–Ø_–§–ê–ô–õ–ê)
            if –ø–∞–ø–∫–∞ and not os.path.exists(–ø–∞–ø–∫–∞):
                os.makedirs(–ø–∞–ø–∫–∞)
            
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
            —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ = —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤—â–∏–∫.—Å–æ–∑–¥–∞—Ç—å_—Å—Ç—Ä—É–∫—Ç—É—Ä—É_—Ñ–∞–π–ª–∞(self.—Å—Ç–∞—Ç—å–∏)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
            with open(–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.–ü–£–¢–¨_–°–û–•–†–ê–ù–ï–ù–ò–Ø_–§–ê–ô–õ–ê, 'w', encoding='utf-8') as —Ñ–∞–π–ª:
                —Ñ–∞–π–ª.write(—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
            
            –ª–æ–≥–≥–µ—Ä.–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: {–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.–ü–£–¢–¨_–°–û–•–†–ê–ù–ï–ù–ò–Ø_–§–ê–ô–õ–ê}")
            
        except Exception as e:
            –ª–æ–≥–≥–µ—Ä.–æ—à–∏–±–∫–∞(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {str(e)}")


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞"""
    print("üöÄ –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π Inter RAO...")
    print("=" * 50)
    
    –ø–∞—Ä—Å–µ—Ä = –ü–∞—Ä—Å–µ—Ä–ë–∞–∑—ã–ó–Ω–∞–Ω–∏–π()
    —É—Å–ø–µ—Ö = –ø–∞—Ä—Å–µ—Ä.–∑–∞–ø—É—Å—Ç–∏—Ç—å_–ø–∞—Ä—Å–∏–Ω–≥()
    
    if —É—Å–ø–µ—Ö:
        print("‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!")
        print(f"üìÅ –§–∞–π–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏: {–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.–ü–£–¢–¨_–°–û–•–†–ê–ù–ï–ù–ò–Ø_–§–ê–ô–õ–ê}")
    else:
        print("‚ùå –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —Å –æ—à–∏–±–∫–∞–º–∏")
    
    print("=" * 50)


if __name__ == "__main__":
    main()
